% Compile with XeLaTeX, TeXLive 2013 or more recent
\input{../lecture-template/config}

\title{Title}

\begin{document}

\begin{frame}
\titlepage
\end{frame}

\section{Обзор}

\begin{frame}
\tableofcontents
\end{frame} 

\begin{frame}{На прошлой лекции}

\begin{itemize}
    \item Основы MPI.
\end{itemize}

\end{frame}

\section{Классификация архитектур вычислительных систем}

\begin{frame}{Классификация Флинна}

\begin{table}[htp]
    \begin{center}
    \begin{tabular}{|l|c|c|}
        \hline
                                & Single data   & Multiple data \\
        \hline
        Single instruction      & SISD          & SIMD \\
        \hline
        Multiple instruction    & MISD          & MIMD \\
        \hline
    \end{tabular}
    \end{center}
\end{table}

\end{frame}

\section{Состояние гонки}

\begin{frame}{Определение}

Состояние гонки (\abbr Race condition) --- ошибка в многопоточной программе, при которой работа приложения зависит от того, в каком порядке выполняются части кода.

Свое название получила от похожей ошибки проектирования электронных схем (Гонки сигналов).

Состояние гонки --- ошибка проявляющаяся в случайный момент времени.

\end{frame}

\begin{frame}[fragile]{Пример}

\begin{lstlisting}[language=C++,basicstyle=\ttfamily,keywordstyle=\color{blue},basicstyle=\footnotesize]
int N = 10;
int x = 0;
\end{lstlisting}

\begin{columns}[t]
    \begin{column}[T]{0.45\textwidth}
    \begin{lstlisting}[language=C++,basicstyle=\ttfamily,keywordstyle=\color{blue},basicstyle=\footnotesize]
// thread 0
for (i = 0; i < N; ++i) {
    x *= 2;
}
    \end{lstlisting}
    \end{column}
    \begin{column}[T]{0.45\textwidth}
    \begin{lstlisting}[language=C++,basicstyle=\ttfamily,keywordstyle=\color{blue},basicstyle=\footnotesize]
// thread 1
for (i = 0; i < N; ++i) {
    x += 2;
}
    \end{lstlisting}
    \end{column}
\end{columns}

\begin{lstlisting}[language=C++,basicstyle=\ttfamily,keywordstyle=\color{blue},basicstyle=\footnotesize]
printf("%d\n", x);
\end{lstlisting}

\end{frame}

\section{Синхронизация}

\begin{frame}{Deadlock}
\todo
\end{frame}

\begin{frame}{Livelock}
\todo
\end{frame}

\begin{frame}[fragile]{Алгоритм Деккера}

\begin{lstlisting}[language=C++,basicstyle=\ttfamily,keywordstyle=\color{blue},basicstyle=\scriptsize]
bool flag[2] = {false, false};
bool turn = false; // or true
\end{lstlisting}

\begin{columns}[t]
    \begin{column}[T]{0.45\textwidth}
        \begin{lstlisting}[language=C++,basicstyle=\ttfamily,keywordstyle=\color{blue},basicstyle=\scriptsize]
// thread 0
flag[0] = true;
while (flag[1]) {
    if (turn) {
        flag[0] = false;
        while (turn);
        flag[0] = true;
    }
}

// critical section
//...
turn = true;
flag[0] = false;
// end of critical section
// ...
        \end{lstlisting}
    \end{column}
    \begin{column}[T]{0.45\textwidth}
        \begin{lstlisting}[language=C++,basicstyle=\ttfamily,keywordstyle=\color{blue},basicstyle=\scriptsize]
// thread 1
flag[1] = true;
while (flag[0]) {
    if (!turn) {
        flag[1] = false;
        while (!turn);
        flag[1] = true;
    }
}

// critical section
//...
turn = false;
flag[0] = false;
// end of critical section
// ...
        \end{lstlisting}
    \end{column}
\end{columns}

\end{frame}

\section{Конец}
% The final "thank you" frame 

\begin{frame}{Задания}
\end{frame}

\begin{frame}{На следующей лекции}
\end{frame}

\begin{frame}

{\huge{Спасибо за внимание!}\par}

\vfill

\tiny{\textit{Замечание}: все торговые марки и логотипы, использованные в данном материале, являются собственностью их владельцев. Представленная здесь точка зрения отражает личное мнение автора, не выступающего от лица какой-либо организации.}

\end{frame}

\end{document}